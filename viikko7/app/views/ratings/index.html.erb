<h2>List of ratings</h2>

<% cache 'ratings_all', expires_in:10.minutes do %>

Total of <%= @ratings.count %> ratings given

<ul>
  <% @ratings.each do |rating| %>
    <li> <%= rating %> <%= link_to rating.user.username, rating.user %> </li>
  <% end %>
</ul>

<h3>Best beers</h3>
<table class="table table-hover">
  <thead>
  <tr>
    <th></th>
    <th>average</th>
  </tr>
  </thead>
  <tbody>
  <% @top_beers.each do |beer| %>
      <tr>
        <td><%= link_to beer.name, beer %></td>
        <td><%= beer.average_rating %></td>
      </tr>
  <% end %>
  </tbody>
</table>

<h3>Best styles</h3>
<table class="table table-hover">
  <thead>
  <tr>
    <th></th>
    <th>average</th>
  </tr>
  </thead>
  <tbody>
  <% @top_styles.each do |style| %>
      <tr>
        <td><%= style.name %></td>
        <td><%= round(style.average_rating) %></td>
      </tr>
  <% end %>
  </tbody>
</table>

<h3>Best breweries</h3>
<table class="table table-hover">
  <thead>
  <tr>
    <th></th>
    <th>average</th>
  </tr>
  </thead>
  <tbody>
  <% @top_breweries.each do |brewery| %>
      <tr>
        <td><%= link_to brewery.name, brewery %></td>
        <td><%= brewery.average_rating %></td>
      </tr>
  <% end %>
  </tbody>
</table>

<h3>Most active users</h3>
<table class="table table-hover">
  <thead>
  <tr>
    <th></th>
    <th>favourite beer</th>
    <th>preferred style</th>
    <th>favourite brewery</th>
    <th>ratings</th>
  </tr>
  </thead>
  <tbody>
  <% @most_ratings.each do |user| %>
      <tr>
        <td><%= user.username %></td>
        <td><%= user.favorite_beer %></td>
        <td><%= user.favorite_style %></td>
        <td><%= user.favorite_brewery %></td>
        <td><%= user.ratings.count %></td>
      </tr>
  <% end %>
  </tbody>
</table>

<h3>Recent ratings</h3>
<table class="table table-hover">
  <thead>
  <tr>
    <th>Beer</th>
    <th>Style</th>
    <th>Rating</th>
    <th>Rated by</th>
  </tr>
  </thead>
  <tbody>
  <% @recent_ratings.each do |rating| %>
      <tr>
        <td><%= rating.beer %></td>
        <td><%= rating.beer.style %></td>
        <td><%= rating.score %></td>
        <td><%= rating.user %></td>
      </tr>
  <% end %>
  </tbody>
</table>

<% end %>

<%= link_to 'New Rating', new_rating_path if current_user %>